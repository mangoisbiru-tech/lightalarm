<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lightning Storm Effect</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.7.0/p5.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background: #000;
        }
    </style>
</head>
<body>
    <script>
        // Lightning Storm Effect
        // A generative lightning bolt system with screen flashes
        
        let flashAlpha = 0;
        let flashDuration = 0;
        let nextFlashTime = 0;
        let lightningBolt = [];
        let boltVisible = false;
        let boltDuration = 0;
        
        function setup() {
            createCanvas(windowWidth, windowHeight);
            // Set next flash time to a random interval between 5-10 seconds
            nextFlashTime = millis() + random(5000, 10000);
        }
        
        function draw() {
            // Dark background with subtle blue/purple tint
            background(10, 10, 30);
            
            // Check if it's time for a lightning flash
            if (millis() >= nextFlashTime) {
                triggerLightning();
                // Set next flash time
                nextFlashTime = millis() + random(5000, 10000);
            }
            
            // Handle flash effect
            if (flashDuration > 0) {
                flashDuration -= 16; // Assuming 60fps
                flashAlpha = map(flashDuration, 0, 200, 0, 255); // Flash lasts ~200ms
                
                // Draw flash overlay
                fill(255, 255, 255, flashAlpha);
                noStroke();
                rect(0, 0, width, height);
            }
            
            // Handle lightning bolt visibility
            if (boltVisible && boltDuration > 0) {
                boltDuration -= 16; // Bolt visible for ~100ms
                drawLightningBolt();
            } else if (boltVisible && boltDuration <= 0) {
                boltVisible = false;
                lightningBolt = [];
            }
        }
        
        function triggerLightning() {
            // Start flash effect
            flashDuration = 200; // Flash duration in milliseconds
            flashAlpha = 255;
            
            // Generate lightning bolt
            generateLightningBolt();
            boltVisible = true;
            boltDuration = 100; // Bolt visible for 100ms
        }
        
        function generateLightningBolt() {
            // Clear previous bolt
            lightningBolt = [];
            
            // Start point at top of screen (random x position)
            let startX = random(width * 0.2, width * 0.8);
            let startY = 0;
            
            // Generate main bolt path using recursive branching algorithm
            let mainBolt = generateBoltPath(startX, startY, 0, height, 0);
            lightningBolt.push(...mainBolt);
            
            // Add some secondary branches
            for (let i = 0; i < 3; i++) {
                let branchPoint = mainBolt[Math.floor(random(mainBolt.length * 0.3, mainBolt.length * 0.7))];
                let branchBolt = generateBoltPath(
                    branchPoint.x, 
                    branchPoint.y, 
                    random(-PI/4, PI/4), 
                    random(50, 150), 
                    1
                );
                lightningBolt.push(...branchBolt);
            }
        }
        
        function generateBoltPath(startX, startY, angle, maxLength, depth) {
            let path = [];
            let currentX = startX;
            let currentY = startY;
            let currentAngle = angle;
            let segmentLength = 0;
            let totalLength = 0;
            
            // Add starting point
            path.push({x: currentX, y: currentY});
            
            // Generate bolt segments using L-system approach
            while (totalLength < maxLength && currentY < height) {
                // Calculate segment length (shorter segments for more detail)
                segmentLength = random(5, 20) * (1 - depth * 0.3); // Shorter branches
                
                // Add some randomness to angle
                currentAngle += random(-0.3, 0.3);
                
                // Calculate next point
                let nextX = currentX + cos(currentAngle) * segmentLength;
                let nextY = currentY + sin(currentAngle) * segmentLength;
                
                // Add some horizontal drift
                nextX += random(-10, 10);
                
                // Ensure we don't go off screen
                nextX = constrain(nextX, 0, width);
                
                // Add point to path
                path.push({x: nextX, y: nextY});
                
                // Update current position
                currentX = nextX;
                currentY = nextY;
                totalLength += segmentLength;
                
                // Add branching probability (higher for main bolt)
                if (random() < 0.1 * (1 - depth * 0.5) && depth < 2) {
                    let branchAngle = currentAngle + random(-PI/3, PI/3);
                    let branchLength = random(30, 80);
                    let branchPath = generateBoltPath(currentX, currentY, branchAngle, branchLength, depth + 1);
                    path.push(...branchPath);
                }
            }
            
            return path;
        }
        
        function drawLightningBolt() {
            if (lightningBolt.length < 2) return;
            
            // Draw bolt with varying thickness and brightness
            strokeWeight(3);
            stroke(200, 220, 255, 200); // Bright blue-white
            
            // Draw main bolt path
            for (let i = 0; i < lightningBolt.length - 1; i++) {
                let alpha = map(i, 0, lightningBolt.length, 255, 100);
                stroke(200, 220, 255, alpha);
                
                line(
                    lightningBolt[i].x, 
                    lightningBolt[i].y, 
                    lightningBolt[i + 1].x, 
                    lightningBolt[i + 1].y
                );
            }
            
            // Add glow effect
            strokeWeight(8);
            stroke(150, 180, 255, 50);
            for (let i = 0; i < lightningBolt.length - 1; i++) {
                line(
                    lightningBolt[i].x, 
                    lightningBolt[i].y, 
                    lightningBolt[i + 1].x, 
                    lightningBolt[i + 1].y
                );
            }
        }
        
        function windowResized() {
            resizeCanvas(windowWidth, windowHeight);
        }
        
        // Add some atmospheric effects
        function drawAtmosphere() {
            // Subtle gradient overlay
            for (let i = 0; i < height; i += 2) {
                let alpha = map(i, 0, height, 0, 20);
                stroke(20, 20, 50, alpha);
                line(0, i, width, i);
            }
        }
    </script>
</body>
</html>


